from subprocess import call

Import( 'env' )

env.Append(
	CCFLAGS = [
	'-DTVM_INTERNALS',
	'-DTVM_DISPATCH_SWITCH',
	'-DTVM_EMULATE_T2',
	'-DTVM_LITTLE_ENDIAN',
	'-DTVM_MEM_INTF_AVR',
	'-DTVM_PACKED_ECTX',
	'-DTVM_OS_NONE',
	'-DTVM_USE_INLINE',
	'-DTVM_WORD_LENGTH=2'
	])

env.Append(
  CCFLAGS = [
		'-mmcu=atmega8'
    ])

libtvm = env.Library([	
  'interpreter.c',
	#'mem_array.c',
	'mem_avr.c',
	#'mem_bigendian.c',
	'scheduler.c',
	#'tencode.c',
	###
	'ins_alt.c',
	'ins_barrier.c',
	'ins_chan.c',
	#'ins_float.c',
	#'ins_pi.c',
	#'ins_mobile.c',
	'ins_pri.c',
	#'ins_proc.c',
	#'ins_rmox.c',
	'ins_sec.c',
	'ins_timer.c',
	#'ins_t800.c',
	#'ins_t9000.c',
	'instructions.c',
	'mem.c',
	###
	'jumptbl_pri.c',
	'jumptbl_sec.c',
	'jumptbl_ex_sec.c'
])

files = [
	'ins_alt.c',
	'ins_barrier.c', 
	'ins_chan.c', 
	#'ins_float.c',  
	'ins_pri.c', 
	#'ins_proc.c', 
	'ins_sec.c', 
	'ins_t800.c', 
	'ins_timer.c']

def make_dispatch (fls):
	args = ['python', 'make-dispatch.py']
	args.extend(fls)
	call(args)

make_dispatch(files)
